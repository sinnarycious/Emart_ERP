<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sale">

	<select id="findMonday" parameterType="string" resultType="string" >
		SELECT TO_CHAR(NEXT_DAY(TO_DATE(#{sqlDate})-14, 'ì›”'), 'YYYY-MM-DD') LAST_WEEK
		FROM DUAL
	</select>

	<select id="findMonth" parameterType="string" resultType="string" >
		SELECT TO_CHAR(TRUNC(ADD_MONTHS(#{sqlDate},-1), 'MM')) "LAST_MONTH" FROM DUAL
	</select>

	<resultMap type="sale" id="lineProfitMap">
		<result column="SALE_DATE" property="saleDate" />
		<result column="SALE_SUM" property="saleSum" />
	</resultMap>

	<select id="selectLineWeekProfit" parameterType="string" resultMap="lineProfitMap">
		SELECT SALE_DATE, SUM(SALE_PRICE) "SALE_SUM" FROM SALE
		WHERE SALE_DATE BETWEEN TO_DATE(#{sqlWeekDate})
  		  AND SYSDATE
		GROUP BY SALE_DATE
        ORDER BY SALE_DATE
	</select>
	
	<select id="selectLineLastMonthProfit" parameterType="string" resultMap="lineProfitMap">
		SELECT SALE_DATE, SUM(SALE_PRICE) "SALE_SUM" FROM SALE
		WHERE SALE_DATE BETWEEN TO_DATE(#{sqlMonthDate})
	  	  AND LAST_DAY(TO_DATE(#{sqlMonthDate}))
		GROUP BY SALE_DATE
		ORDER BY SALE_DATE
	</select>
	
	<select id="selectLineThisMonthProfit" resultMap="lineProfitMap">
		SELECT SALE_DATE, SUM(SALE_PRICE) "SALE_SUM" FROM SALE
		WHERE SALE_DATE BETWEEN (SELECT TRUNC(SYSDATE, 'MM') "LAST_MONTH" FROM DUAL)
  		  AND SYSDATE
		GROUP BY SALE_DATE
		ORDER BY SALE_DATE
	</select>


	<resultMap type="sale" id="saleMap">
		<result column="SALE_NO" property="saleNo" />
		<result column="SALE_COUNT" property="saleCount" />
		<result column="SALE_PRICE" property="salePrice" />
		<result column="SALE_DATE" property="saleDate" />
		<result column="SALE_CAT_NO" property="saleCatNo" />
		<result column="SALE_NAME" property="saleName" />
		<result column="USER_NO" property="userNo" />
		<result column="SALE_SUM" property="saleSum" />
	</resultMap>
	
	<select id="selectSaleList" resultMap="saleMap">
		SELECT * FROM SALE
		ORDER BY SALE_NO DESC
	</select>
	
	<select id="selectSaleTotalContents" resultType="_int">
		SELECT COUNT(*) FROM SALE
	</select>
	
	<select id="selectLineWeekProfit" parameterType="string" resultMap="doughnutProfitMap">
	</select>

</mapper>